---
name: publish documentation
# description: If changes are made (e.g. by build action) in relevat files, generate new documentation
on:
  push:
    branches: [main]
    paths:
      - 'README.adoc'
      - 'docs/Makefile'
      - 'docs/algebras.dot.m4'
      - '.github/workflows/publish-documentation.yml'
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    container: asciidoctor/docker-asciidoctor:latest
    steps:
      - uses: actions/checkout@v3
        with:
          set-safe-directory: true
      - name: Create html from adoc
        run: |
          cd docs
          apk add graphviz m4
          make clean index.html
          git config --global --add safe.directory $(pwd)
          git status
      - name: Commit generated dot file if it changed
        uses: EndBug/add-and-commit@v9.0.1
        with:
          message: Automated update of documentation https://mihxil.github.io/math/
          add: docs
        if: ${{ github.event_name == 'push' }}
